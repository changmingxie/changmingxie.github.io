{
  "filename": "deploy.md",
  "__html": "<h1 id=\"server%E9%83%A8%E7%BD%B2%E7%A4%BA%E4%BE%8B\">server部署示例 <a class=\"header-anchor\" href=\"#server%E9%83%A8%E7%BD%B2%E7%A4%BA%E4%BE%8B\">#</a></h1>\n<p>当前版本支持的<a href=\"/zh-cn/aggdocs/tutorial/registry/index.html\">注册中心</a>有：</p>\n<ul>\n<li>direct(默认，不支持实时扩缩容)</li>\n<li>nacos</li>\n<li>zookeeper</li>\n</ul>\n<p>server支持多种存储方式</p>\n<ul>\n<li>memory(默认，仅适用于测试环境)</li>\n<li>rocksdb(仅适用于测试环境)</li>\n<li>jdbc</li>\n<li>redis</li>\n<li>shard-redis</li>\n<li>redis-cluster</li>\n</ul>\n<p>server支持对补偿任务的管理(quartz)</p>\n<ul>\n<li>quartz缓存模式</li>\n<li>quartz使用db,非集群模式</li>\n<li>quartz集群模式(默认)</li>\n</ul>\n<p>以下以注册中心[direct]+存储类型[memory]+任务部署类型[quartz集群模式]这种组合为例。</p>\n<h2 id=\"%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5\">准备阶段 <a class=\"header-anchor\" href=\"#%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5\">#</a></h2>\n<h3 id=\"%E5%88%9D%E5%A7%8B%E5%8C%96quartz%E6%95%B0%E6%8D%AE%E5%BA%93\">初始化quartz数据库 <a class=\"header-anchor\" href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96quartz%E6%95%B0%E6%8D%AE%E5%BA%93\">#</a></h3>\n<p>在192.168.108.179创建数据库\n这里使用mysql数据库，最新脚本请<a href=\"https://github.com/changmingxie/tcc-transaction/blob/master-2.x/tcc-transaction-server/src/main/dbscripts/db_init.sql\">查看</a></p>\n<pre><code class=\"language-sql\"><span class=\"hljs-keyword\">CREATE</span>\n<span class=\"hljs-keyword\">DATABASE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`TCC_SERVER`</span> <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> <span class=\"hljs-string\">'utf8mb4'</span> <span class=\"hljs-keyword\">COLLATE</span> <span class=\"hljs-string\">'utf8mb4_unicode_ci'</span>;\n\n<span class=\"hljs-keyword\">USE</span>\n<span class=\"hljs-string\">`TCC_SERVER`</span>;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_FIRED_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_PAUSED_TRIGGER_GRPS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_SCHEDULER_STATE;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_LOCKS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_SIMPLE_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_SIMPROP_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_CRON_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_BLOB_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_JOB_DETAILS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_CALENDARS;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_JOB_DETAILS\n(\n    SCHED_NAME        <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_NAME          <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_GROUP         <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    DESCRIPTION       <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">250</span>) <span class=\"hljs-literal\">NULL</span>,\n    JOB_CLASS_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">250</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    IS_DURABLE        <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    IS_NONCONCURRENT  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    IS_UPDATE_DATA    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    REQUESTS_RECOVERY <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_DATA          <span class=\"hljs-built_in\">BLOB</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, JOB_NAME, JOB_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_TRIGGERS\n(\n    SCHED_NAME     <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_NAME       <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_GROUP      <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    DESCRIPTION    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">250</span>) <span class=\"hljs-literal\">NULL</span>,\n    NEXT_FIRE_TIME <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-literal\">NULL</span>,\n    PREV_FIRE_TIME <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-literal\">NULL</span>,\n    <span class=\"hljs-keyword\">PRIORITY</span>       <span class=\"hljs-built_in\">INTEGER</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_STATE  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">16</span>)  <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_TYPE   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">8</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    START_TIME     <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    END_TIME       <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-literal\">NULL</span>,\n    CALENDAR_NAME  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-literal\">NULL</span>,\n    MISFIRE_INSTR  <span class=\"hljs-built_in\">SMALLINT</span>(<span class=\"hljs-number\">2</span>) <span class=\"hljs-literal\">NULL</span>,\n    JOB_DATA       <span class=\"hljs-built_in\">BLOB</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, JOB_NAME, JOB_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_JOB_DETAILS (SCHED_NAME, JOB_NAME, JOB_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_SIMPLE_TRIGGERS\n(\n    SCHED_NAME      <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    REPEAT_COUNT    <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">7</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    REPEAT_INTERVAL <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">12</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TIMES_TRIGGERED <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">10</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_CRON_TRIGGERS\n(\n    SCHED_NAME      <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    CRON_EXPRESSION <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TIME_ZONE_ID    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">80</span>),\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_SIMPROP_TRIGGERS\n(\n    SCHED_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    STR_PROP_1    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">512</span>) <span class=\"hljs-literal\">NULL</span>,\n    STR_PROP_2    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">512</span>) <span class=\"hljs-literal\">NULL</span>,\n    STR_PROP_3    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">512</span>) <span class=\"hljs-literal\">NULL</span>,\n    INT_PROP_1    <span class=\"hljs-built_in\">INT</span> <span class=\"hljs-literal\">NULL</span>,\n    INT_PROP_2    <span class=\"hljs-built_in\">INT</span> <span class=\"hljs-literal\">NULL</span>,\n    LONG_PROP_1   <span class=\"hljs-built_in\">BIGINT</span> <span class=\"hljs-literal\">NULL</span>,\n    LONG_PROP_2   <span class=\"hljs-built_in\">BIGINT</span> <span class=\"hljs-literal\">NULL</span>,\n    DEC_PROP_1    <span class=\"hljs-built_in\">NUMERIC</span>(<span class=\"hljs-number\">13</span>, <span class=\"hljs-number\">4</span>) <span class=\"hljs-literal\">NULL</span>,\n    DEC_PROP_2    <span class=\"hljs-built_in\">NUMERIC</span>(<span class=\"hljs-number\">13</span>, <span class=\"hljs-number\">4</span>) <span class=\"hljs-literal\">NULL</span>,\n    BOOL_PROP_1   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-literal\">NULL</span>,\n    BOOL_PROP_2   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_BLOB_TRIGGERS\n(\n    SCHED_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    BLOB_DATA     <span class=\"hljs-built_in\">BLOB</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">INDEX</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_CALENDARS\n(\n    SCHED_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    CALENDAR_NAME <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    CALENDAR      <span class=\"hljs-built_in\">BLOB</span>         <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, CALENDAR_NAME)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_PAUSED_TRIGGER_GRPS\n(\n    SCHED_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_FIRED_TRIGGERS\n(\n    SCHED_NAME        <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    ENTRY_ID          <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">95</span>)  <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME      <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP     <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    INSTANCE_NAME     <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    FIRED_TIME        <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    SCHED_TIME        <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    <span class=\"hljs-keyword\">PRIORITY</span>          <span class=\"hljs-built_in\">INTEGER</span>      <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    STATE             <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">16</span>)  <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_NAME          <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-literal\">NULL</span>,\n    JOB_GROUP         <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-literal\">NULL</span>,\n    IS_NONCONCURRENT  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-literal\">NULL</span>,\n    REQUESTS_RECOVERY <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, ENTRY_ID)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_SCHEDULER_STATE\n(\n    SCHED_NAME        <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    INSTANCE_NAME     <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    LAST_CHECKIN_TIME <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    CHECKIN_INTERVAL  <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, INSTANCE_NAME)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_LOCKS\n(\n    SCHED_NAME <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    LOCK_NAME  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">40</span>)  <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, LOCK_NAME)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_J_REQ_RECOVERY <span class=\"hljs-keyword\">ON</span> QRTZ_JOB_DETAILS (SCHED_NAME, REQUESTS_RECOVERY);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_J_GRP <span class=\"hljs-keyword\">ON</span> QRTZ_JOB_DETAILS (SCHED_NAME, JOB_GROUP);\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_J <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, JOB_NAME, JOB_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_JG <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, JOB_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_C <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, CALENDAR_NAME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_G <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_STATE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_STATE);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_N_STATE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP, TRIGGER_STATE);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_N_G_STATE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_GROUP, TRIGGER_STATE);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NEXT_FIRE_TIME <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, NEXT_FIRE_TIME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NFT_ST <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_STATE, NEXT_FIRE_TIME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NFT_MISFIRE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NFT_ST_MISFIRE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME, TRIGGER_STATE);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NFT_ST_MISFIRE_GRP <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME, TRIGGER_GROUP,\n                                                             TRIGGER_STATE);\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_TRIG_INST_NAME <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, INSTANCE_NAME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_INST_JOB_REQ_RCVRY <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, INSTANCE_NAME, REQUESTS_RECOVERY);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_J_G <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, JOB_NAME, JOB_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_JG <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, JOB_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_T_G <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_TG <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, TRIGGER_GROUP);\n\n<span class=\"hljs-keyword\">commit</span>;\n\n</code></pre>\n<h3 id=\"%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0release%E7%89%88%E6%9C%AC\">下载最新<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">RELEASE</a>版本 <a class=\"header-anchor\" href=\"#%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0release%E7%89%88%E6%9C%AC\">#</a></h3>\n<p>下载最新的安装包tcc-transaction-server-xxx.tar.gz，依次</p>\n<h2 id=\"%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8\">安装并启动 <a class=\"header-anchor\" href=\"#%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8\">#</a></h2>\n<h3 id=\"linux%2Fmac%E7%8E%AF%E5%A2%83\">linux/mac环境 <a class=\"header-anchor\" href=\"#linux%2Fmac%E7%8E%AF%E5%A2%83\">#</a></h3>\n<p><strong>创建server目录</strong></p>\n<pre><code class=\"language-shell\">makdir server \ncd  server  \n</code></pre>\n<p><strong>下载tcc-transaction-server-xxx.tar.gz-xxx.tar.gz</strong>，解压到server目录</p>\n<pre><code class=\"language-shell\">server % tar zxvf tcc-transaction-server-2.0.0.tar.gz\nx conf/application.yaml\nx lib/tcc-transaction-server.jar\nx conf/\nx conf/logback.xml\nx bin/\nx bin/startup.sh\nx bin/startup.cmd\nx bin/shutdown.sh\nx bin/shutdown.cmd\nserver % tree\n.\n├── bin\n│         ├── shutdown.cmd\n│         ├── shutdown.sh\n│         ├── startup.cmd\n│         └── startup.sh\n├── conf\n│         ├── application.yaml\n│         └── logback.xml\n├── lib\n│         └── tcc-transaction-server.jar\n└── tcc-transaction-server-2.0.0.tar.gz\n\n3 directories, 8 files\nserver % \n</code></pre>\n<p>conf/application.yaml<a href=\"/zh-cn/docs/tutorial/configurations.html#server%E7%AB%AF\">详细配置详见</a><br>\n以下以注册中心[direct]+存储类型[memory]+任务部署类型[quartz集群模式]这种组合为例。application.yaml可如下配置：</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">server:</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">12332</span>\n<span class=\"hljs-attr\">logging:</span>\n  <span class=\"hljs-attr\">level:</span>\n    <span class=\"hljs-attr\">root:</span> <span class=\"hljs-string\">info</span>\n<span class=\"hljs-attr\">spring:</span>\n  <span class=\"hljs-attr\">application:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">tcc-transaction-server</span>\n  <span class=\"hljs-attr\">tcc:</span>\n    <span class=\"hljs-attr\">storage:</span>\n      <span class=\"hljs-attr\">storage-type:</span> <span class=\"hljs-string\">memory</span>\n      <span class=\"hljs-attr\">max-attempts:</span> <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-attr\">recovery:</span>\n      <span class=\"hljs-attr\">quartz-clustered:</span> <span class=\"hljs-literal\">true</span>\n      <span class=\"hljs-attr\">quartz-data-source-url:</span> <span class=\"hljs-string\">jdbc:mysql://localhost:3306/TCC_SERVER?useSSL=false&amp;allowPublicKeyRetrieval=true</span>\n      <span class=\"hljs-attr\">quartz-data-source-driver:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n      <span class=\"hljs-attr\">quartz-data-source-user:</span> <span class=\"hljs-string\">root</span>\n      <span class=\"hljs-attr\">quartz-data-source-password:</span> <span class=\"hljs-string\">welcome1</span>\n    <span class=\"hljs-attr\">registry:</span>\n      <span class=\"hljs-attr\">registry-type:</span> <span class=\"hljs-string\">direct</span>\n      <span class=\"hljs-attr\">cluster-name:</span> <span class=\"hljs-string\">default</span>\n    <span class=\"hljs-attr\">remoting:</span>\n      <span class=\"hljs-attr\">listen-port:</span> <span class=\"hljs-number\">2332</span>\n\n</code></pre>\n<p><strong>启动server</strong></p>\n<pre><code class=\"language-shell\">sh bin/startup.sh\n</code></pre>\n<h3 id=\"windows%E7%8E%AF%E5%A2%83\">windows环境 <a class=\"header-anchor\" href=\"#windows%E7%8E%AF%E5%A2%83\">#</a></h3>\n<p>创建server目录\n下载tcc-transaction-server-xxx.zip，到server目录，并解压\n双击bin/startup.cmd，启动server</p>\n",
  "link": "/zh-cn/aggdocs/ops/server/deploy.html",
  "meta": {}
}