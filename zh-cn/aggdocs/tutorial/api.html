<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="api" />
	<meta name="description" content="api" />
	<!-- 网页标签标题 -->
	<title>api</title>
	<link rel="shortcut icon" href="/img/tcc_logo.png"/>
	<link rel="stylesheet" href="/build/aggDocumentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/tcc_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><span><a href="/zh-cn/index.html" target="_self">首页</a></span></li><li class="menu-item menu-item-normal"><div class="nav-container"><div class="word"><a>文档</a></div><ul class="sub-nav-container" style="width:220px"><li><a href="/zh-cn/docs/what-is-tcctransaction.html" target="_self">TCC文档</a></li><li><a href="/zh-cn/aggdocs/what-is-aggregateframework.html" target="_self">AGG文档</a></li></ul></div></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/blog/index.html" target="_self">博客</a></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/community/index.html" target="_self">社区</a></span></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>AGG文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>概述</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/what-is-aggregateframework.html" target="_self">AGGREGATE-FRAMEWORK是什么</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/terminology.html" target="_self">术语</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/faq.html" target="_self">FAQ</a></li></ul></li><li class="menu-item menu-item-level-1"><span>用户指南</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/tutorial/quickstart.html" target="_self">快速开始</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/tutorial/configurations.html" target="_self">参数配置</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/tutorial/api.html" target="_self">API支持</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/tutorial/eventhandler.html" target="_self">事件处理器</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>连接模式<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/connectionmode/embedded.html" target="_self">embedded模式</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/connectionmode/server.html" target="_self">server模式</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>存储类型<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/storagetype/memory.html" target="_self">memory</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/storagetype/rocksdb.html" target="_self">rocksdb</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/storagetype/jdbc.html" target="_self">jdbc</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/storagetype/redis.html" target="_self">redis</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/storagetype/shard-redis.html" target="_self">shard-redis</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/storagetype/redis-cluster.html" target="_self">redis-cluster</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/storagetype/remoting.html" target="_self">remoting</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/storagetype/custom.html" target="_self">custom</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>事件序列化<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/serializer/index.html" target="_self">说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/serializer/kryo.html" target="_self">kryo</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/serializer/fastjson.html" target="_self">fastjson</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/serializer/custom.html" target="_self">custom</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>注册中心支持<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/registry/index.html" target="_self">说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/registry/direct.html" target="_self">direct</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/registry/nacos.html" target="_self">nacos</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/registry/zookeeper.html" target="_self">zookeeper</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/tutorial/registry/custom.html" target="_self">custom</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>运维指南</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/ops/upgrade.html" target="_self">版本升级指南</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>server部署<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/ops/server/index.html" target="_self">部署说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/ops/server/deploy.html" target="_self">部署示例</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>dashboard部署<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/ops/dashboard/index.html" target="_self">部署说明</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/aggdocs/ops/dashboard/deploy.html" target="_self">部署示例</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/aggdocs/ops/dashboard/dashboard-guild.html" target="_self">dashboard使用手册</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1 id="api%E6%94%AF%E6%8C%81">API支持 <a class="header-anchor" href="#api%E6%94%AF%E6%8C%81">#</a></h1>
<h2 id="%E6%A0%B8%E5%BF%83%E7%B1%BB">核心类 <a class="header-anchor" href="#%E6%A0%B8%E5%BF%83%E7%B1%BB">#</a></h2>
<h3 id="transactionmanagerinterceptor">TransactionManagerInterceptor <a class="header-anchor" href="#transactionmanagerinterceptor">#</a></h3>
<p>对<strong>PlatformTransactionManager</strong>的getTransaction、commit、rollback方法进行拦截，提供基于乐观锁的并发控制、聚合根维度的事务保证和事件发布等能力。<br>
注：对于未显示使用@Transactional注解的方法，相关逻辑在执行<strong>AbstractAggregateRepository</strong>的save方法时触发。</p>
<h3 id="annotationeventlistenerbeanpostprocessor">AnnotationEventListenerBeanPostProcessor <a class="header-anchor" href="#annotationeventlistenerbeanpostprocessor">#</a></h3>
<p>应用启动时，通过该类将方法上含有@EventHandler注解的bean封装成<strong>EventListener</strong>，注册到<strong>SimpleEventBus</strong>作为事件的订阅者</p>
<h3 id="abstractsimpleaggregateroot">AbstractSimpleAggregateRoot <a class="header-anchor" href="#abstractsimpleaggregateroot">#</a></h3>
<p>聚合根对象所需继承的父类，说明：<br>
1.可通过实现CompositeId接口创建复合主键(适用于分库分表的场景)<br>
2.可利用@DaoAwareQuery注解实现聚合根与领域对象之间的关联关系
3.可通过apply方法来发布事件</p>
<h3 id="abstractsimpledomainobject">AbstractSimpleDomainObject <a class="header-anchor" href="#abstractsimpledomainobject">#</a></h3>
<p>领域对象所需继承的父类</p>
<h3 id="aggregaterootdao%E3%80%81collectiveaggregaterootdao">AggregateRootDao、CollectiveAggregateRootDao <a class="header-anchor" href="#aggregaterootdao%E3%80%81collectiveaggregaterootdao">#</a></h3>
<p>聚合根的DAO所需实现的接口，在CollectiveAggregateRootDao额外定义了批量操作的方法</p>
<h3 id="domainobjectdao%E3%80%81collectivedomainobjectdao">DomainObjectDao、CollectiveDomainObjectDao <a class="header-anchor" href="#domainobjectdao%E3%80%81collectivedomainobjectdao">#</a></h3>
<p>领域对象的DAO所需实现的接口，在CollectiveDomainObjectDao额外定义了批量操作的方法</p>
<h3 id="daoawareaggregaterepository">DaoAwareAggregateRepository <a class="header-anchor" href="#daoawareaggregaterepository">#</a></h3>
<p>聚合根的Repository所需继承的父类，实现了对聚合根及其附属领域对象的增、删、改、查操作。</p>
<p>使用示例:</p>
<pre><code class="language-java"><span class="hljs-comment">//该示例中，将Account类作为聚合根，SubAccount类作为领域对象，一个Account下可能存在多个SubAccount</span>
<span class="hljs-comment">//Account.class </span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@EqualsAndHashCode</span>(callSuper = <span class="hljs-keyword">true</span>)
<span class="hljs-meta">@Builder</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSimpleAggregateRoot</span>&lt;<span class="hljs-title">Long</span>&gt; </span>{

    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String accountId;

    <span class="hljs-keyword">private</span> Integer eventStatus;

    <span class="hljs-meta">@DaoAwareQuery</span>(mappedBy = <span class="hljs-string">"account"</span>, select = <span class="hljs-string">"findByParentId"</span>)
    <span class="hljs-keyword">private</span> List&lt;SubAccount&gt; subAccounts = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">applyAccountCreateEvent</span><span class="hljs-params">()</span></span>{
        apply(<span class="hljs-keyword">new</span> AccountCreateEvent(accountId));
    }
}

<span class="hljs-comment">//SubAccount.class</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@EqualsAndHashCode</span>(callSuper = <span class="hljs-keyword">true</span>)
<span class="hljs-meta">@Builder</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubAccount</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSimpleDomainObject</span>&lt;<span class="hljs-title">Long</span>&gt; </span>{

    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String accountId;

    <span class="hljs-keyword">private</span> Account account;

    <span class="hljs-keyword">private</span> Integer eventStatus;
}

<span class="hljs-comment">//AccountDao.class</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AccountDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AggregateRootDao</span>&lt;<span class="hljs-title">Account</span>,<span class="hljs-title">Long</span>&gt; </span>{

    <span class="hljs-function">Account <span class="hljs-title">findByAccountId</span><span class="hljs-params">(@Param(<span class="hljs-string">"accountId"</span>)</span>String accountId)</span>;

    <span class="hljs-function">List&lt;Account&gt; <span class="hljs-title">findByAccountIds</span><span class="hljs-params">(List&lt;String&gt; accountIds)</span></span>;
}

<span class="hljs-comment">//SubAccountDao.class</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SubAccountDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DomainObjectDao</span>&lt;<span class="hljs-title">SubAccount</span>,<span class="hljs-title">Long</span>&gt; </span>{

    <span class="hljs-function">List&lt;SubAccount&gt; <span class="hljs-title">findByParentId</span><span class="hljs-params">(@Param(<span class="hljs-string">"parentId"</span>)</span> Long parentId)</span>;
}

<span class="hljs-comment">//AccountRepository.class</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DaoAwareAggregateRepository</span>&lt;<span class="hljs-title">Account</span>,<span class="hljs-title">Long</span>&gt; </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AccountDao accountDao;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccountRepository</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>(Account<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Account <span class="hljs-title">findByAccountId</span><span class="hljs-params">(String accountId)</span> </span>{
        <span class="hljs-keyword">return</span> fetchAllComponents(accountDao.findByAccountId(accountId));
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Account&gt; <span class="hljs-title">findByAccountIds</span><span class="hljs-params">(List&lt;String&gt; accountIds)</span> </span>{
        <span class="hljs-keyword">return</span> fetchAllComponents(accountDao.findByAccountIds(accountIds));
    }
}
</code></pre>
<p>AccountMapper.xml</p>
<pre><code class="language-xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"AccountDao"</span> &gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"baseResultMap"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"Account"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"ID"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"accountId"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"ACCOUNT_ID"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"eventStatus"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"EVENT_STATUS"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"createTime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"CREATE_TIME"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"lastUpdateTime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"LAST_UPDATE_TIME"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"version"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"VERSION"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sql_select"</span>&gt;</span>
        SELECT ID,
               ACCOUNT_ID,
               EVENT_STATUS,
               VERSION,
               CREATE_TIME,
               LAST_UPDATE_TIME
        FROM ACCOUNT
    <span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findAll"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"baseResultMap"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">"sql_select"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findById"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"baseResultMap"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">"sql_select"</span>/&gt;</span>
		WHERE ID=#{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findByAccountId"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"baseResultMap"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">"sql_select"</span>/&gt;</span>
        WHERE ACCOUNT_ID=#{accountId}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findByAccountIds"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"baseResultMap"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">"sql_select"</span>/&gt;</span>
        WHERE ACCOUNT_ID in 
        <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">","</span> <span class="hljs-attr">open</span>=<span class="hljs-string">"("</span> <span class="hljs-attr">close</span>=<span class="hljs-string">")"</span>&gt;</span>
            #{item}
        <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insert"</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">keyColumn</span>=<span class="hljs-string">"ID"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"Account"</span>&gt;</span>
        INSERT INTO ACCOUNT
            (ACCOUNT_ID,EVENT_STATUS,VERSION,CREATE_TIME,LAST_UPDATE_TIME)
        VALUES
            (#{accountId},#{eventStatus},#{version},#{createTime},#{lastUpdateTime})
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"update"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"Account"</span>&gt;</span>
        UPDATE
        `ACCOUNT`
        SET
        ACCOUNT_ID=#{accountId},
        EVENT_STATUS=#{eventStatus},
        VERSION=#{version},
        LAST_UPDATE_TIME=#{lastUpdateTime}
        WHERE ID=#{id}
        AND VERSION=#{version}-1
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"delete"</span>&gt;</span>
        DELETE FROM ACCOUNT WHERE ID=#{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<p>SubAccountMapper.xml</p>
<pre><code class="language-xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"SubAccountDao"</span> &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"baseResultMap"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"SubAccount"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"ID"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"accountId"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"ACCOUNT_ID"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"account.id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"PARENT_ID"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"eventStatus"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"EVENT_STATUS"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"createTime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"CREATE_TIME"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"lastUpdateTime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"LAST_UPDATE_TIME"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sql_select"</span>&gt;</span>
        SELECT ID,
               ACCOUNT_ID,
               PARENT_ID,
               EVENT_STATUS,
               CREATE_TIME,
               LAST_UPDATE_TIME
        FROM SUB_ACCOUNT
    <span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findById"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"baseResultMap"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">"sql_select"</span>/&gt;</span>
        WHERE ID=#{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findByParentId"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"baseResultMap"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">"sql_select"</span>/&gt;</span>
        WHERE PARENT_ID = #{parentId}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insert"</span> <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">keyColumn</span>=<span class="hljs-string">"ID"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"SubAccount"</span>&gt;</span>
        INSERT INTO SUB_ACCOUNT
            (ACCOUNT_ID,PARENT_ID,EVENT_STATUS,CREATE_TIME,LAST_UPDATE_TIME)
        VALUES
        (#{accountId},#{account.id},#{eventStatus},#{createTime},#{lastUpdateTime})
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"update"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"SubAccount"</span>&gt;</span>
        UPDATE
            `SUB_ACCOUNT`
        SET
            ACCOUNT_ID=#{accountId},
            PARENT_ID=#{account.id},
            EVENT_STATUS=#{eventStatus},
            LAST_UPDATE_TIME=#{lastUpdateTime}
        WHERE ID=#{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>


    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"delete"</span>&gt;</span>
        DELETE FROM
            SUB_ACCOUNT WHERE ID=#{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h2 id="%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3">核心注解 <a class="header-anchor" href="#%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3">#</a></h2>
<h3 id="%40eventhandler">@EventHandler <a class="header-anchor" href="#%40eventhandler">#</a></h3>
<p>此注解作用于方法上，表明使用该方法作为事件处理器，<a href="/zh-cn/aggdocs/tutorial/eventhandler.html">详见</a>。方法的入参有且仅有一个，是所需处理的事件类型（也可以是集合）。<strong>特别注意</strong>：1.可以为一个事件绑定多个事件处理器，彼此相互独立。2.事件处理器所在的类需要被注册到spring容器中。<br>
<strong>属性说明</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:50px">参数名</div></th>
<th style="text-align:left"><div style="width:200px">含义</div></th>
<th style="text-align:left">类型</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">asynchronous</td>
<td style="text-align:left">是否异步执行</td>
<td style="text-align:left">boolean</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">asyncConfig</td>
<td style="text-align:left">异步执行时的配置</td>
<td style="text-align:left"><a href="#%40asyncconfig">AsyncConfig</a></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">postAfterTransaction</td>
<td style="text-align:left">是否在事务提交后执行</td>
<td style="text-align:left">boolean</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">isTransactionMessage</td>
<td style="text-align:left">是否保证事务性(最终一致)</td>
<td style="text-align:left">boolean</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">transactionCheck</td>
<td style="text-align:left">需要保证事务的情况下，校验该处理器是否需要执行的方法名，入参为事件类型，返回boolean值</td>
<td style="text-align:left">TransactionCheck</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">order</td>
<td style="text-align:left">异步confirm</td>
<td style="text-align:left">boolean</td>
<td style="text-align:left">Integer.MIN_VALUE(最先执行)</td>
</tr>
</tbody>
</table>
<h3 id="%40asyncconfig">@AsyncConfig <a class="header-anchor" href="#%40asyncconfig">#</a></h3>
<p>AGG内部集成了<a href="https://lmax-exchange.github.io/disruptor/">Disruptor</a>框架，用于提升异步事件的处理性能，此注解用于设置其相关配置<br>
<strong>属性说明</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left"><div style="width:50px">参数名</div></th>
<th style="text-align:left"><div style="width:200px">含义</div></th>
<th style="text-align:left">类型</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">queueFullPolicy</td>
<td style="text-align:left">环形队列打满时的处理策略</td>
<td style="text-align:left">枚举，可取值：DISCARD直接丢弃、ENQUEUE等待入队、SYNCHRONOUS使用当前线程执行</td>
<td style="text-align:left">SYNCHRONOUS</td>
</tr>
<tr>
<td style="text-align:left">ringBufferSize</td>
<td style="text-align:left">环形缓冲队列大小</td>
<td style="text-align:left">int</td>
<td style="text-align:left">4096</td>
</tr>
<tr>
<td style="text-align:left">workPoolSize</td>
<td style="text-align:left">工作线程数(事件处理器入参为非集合时使用)</td>
<td style="text-align:left">int</td>
<td style="text-align:left">24</td>
</tr>
<tr>
<td style="text-align:left">maxBatchSize</td>
<td style="text-align:left">批处理大小上限(事件处理器入参为集合时使用)</td>
<td style="text-align:left">int</td>
<td style="text-align:left">1024</td>
</tr>
</tbody>
</table>
</div></section><footer class="footer-container"><div class="footer-body"><div class="cols-container"><div class="col col-12"><h3>免责声明</h3><p>TCC-TRANSACTION是一款开源的微服务架构下的TCC型分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/what-is-tcctransaction.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/tutorial/quickstart.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/tutorial/quickstart.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2022 TCC-TRANSACTION</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/aggDocumentation.js"></script>
</body>
</html>
