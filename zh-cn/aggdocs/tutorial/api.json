{
  "filename": "api.md",
  "__html": "<h1 id=\"api%E6%94%AF%E6%8C%81\">API支持 <a class=\"header-anchor\" href=\"#api%E6%94%AF%E6%8C%81\">#</a></h1>\n<h2 id=\"%E6%A0%B8%E5%BF%83%E7%B1%BB\">核心类 <a class=\"header-anchor\" href=\"#%E6%A0%B8%E5%BF%83%E7%B1%BB\">#</a></h2>\n<h3 id=\"transactionmanagerinterceptor\">TransactionManagerInterceptor <a class=\"header-anchor\" href=\"#transactionmanagerinterceptor\">#</a></h3>\n<p>对<strong>PlatformTransactionManager</strong>的getTransaction、commit、rollback方法进行拦截，提供基于乐观锁的并发控制、聚合根维度的事务保证和事件发布等能力。<br>\n注：对于未显示使用@Transactional注解的方法，相关逻辑在执行<strong>AbstractAggregateRepository</strong>的save方法时触发。</p>\n<h3 id=\"annotationeventlistenerbeanpostprocessor\">AnnotationEventListenerBeanPostProcessor <a class=\"header-anchor\" href=\"#annotationeventlistenerbeanpostprocessor\">#</a></h3>\n<p>应用启动时，通过该类将方法上含有@EventHandler注解的bean封装成<strong>EventListener</strong>，注册到<strong>SimpleEventBus</strong>作为事件的订阅者</p>\n<h3 id=\"abstractsimpleaggregateroot\">AbstractSimpleAggregateRoot <a class=\"header-anchor\" href=\"#abstractsimpleaggregateroot\">#</a></h3>\n<p>聚合根对象所需继承的父类，说明：<br>\n1.可通过实现CompositeId接口创建复合主键(适用于分库分表的场景)<br>\n2.可利用@DaoAwareQuery注解实现聚合根与领域对象之间的关联关系\n3.可通过apply方法来发布事件</p>\n<h3 id=\"abstractsimpledomainobject\">AbstractSimpleDomainObject <a class=\"header-anchor\" href=\"#abstractsimpledomainobject\">#</a></h3>\n<p>领域对象所需继承的父类</p>\n<h3 id=\"aggregaterootdao%E3%80%81collectiveaggregaterootdao\">AggregateRootDao、CollectiveAggregateRootDao <a class=\"header-anchor\" href=\"#aggregaterootdao%E3%80%81collectiveaggregaterootdao\">#</a></h3>\n<p>聚合根的DAO所需实现的接口，在CollectiveAggregateRootDao额外定义了批量操作的方法</p>\n<h3 id=\"domainobjectdao%E3%80%81collectivedomainobjectdao\">DomainObjectDao、CollectiveDomainObjectDao <a class=\"header-anchor\" href=\"#domainobjectdao%E3%80%81collectivedomainobjectdao\">#</a></h3>\n<p>领域对象的DAO所需实现的接口，在CollectiveDomainObjectDao额外定义了批量操作的方法</p>\n<h3 id=\"daoawareaggregaterepository\">DaoAwareAggregateRepository <a class=\"header-anchor\" href=\"#daoawareaggregaterepository\">#</a></h3>\n<p>聚合根的Repository所需继承的父类，实现了对聚合根及其附属领域对象的增、删、改、查操作。</p>\n<p>使用示例:</p>\n<pre><code class=\"language-java\"><span class=\"hljs-comment\">//该示例中，将Account类作为聚合根，SubAccount类作为领域对象，一个Account下可能存在多个SubAccount</span>\n<span class=\"hljs-comment\">//Account.class </span>\n<span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper = <span class=\"hljs-keyword\">true</span>)\n<span class=\"hljs-meta\">@Builder</span>\n<span class=\"hljs-meta\">@AllArgsConstructor</span>\n<span class=\"hljs-meta\">@NoArgsConstructor</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Account</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractSimpleAggregateRoot</span>&lt;<span class=\"hljs-title\">Long</span>&gt; </span>{\n\n    <span class=\"hljs-keyword\">private</span> Long id;\n\n    <span class=\"hljs-keyword\">private</span> String accountId;\n\n    <span class=\"hljs-keyword\">private</span> Integer eventStatus;\n\n    <span class=\"hljs-meta\">@DaoAwareQuery</span>(mappedBy = <span class=\"hljs-string\">\"account\"</span>, select = <span class=\"hljs-string\">\"findByParentId\"</span>)\n    <span class=\"hljs-keyword\">private</span> List&lt;SubAccount&gt; subAccounts = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">applyAccountCreateEvent</span><span class=\"hljs-params\">()</span></span>{\n        apply(<span class=\"hljs-keyword\">new</span> AccountCreateEvent(accountId));\n    }\n}\n\n<span class=\"hljs-comment\">//SubAccount.class</span>\n<span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper = <span class=\"hljs-keyword\">true</span>)\n<span class=\"hljs-meta\">@Builder</span>\n<span class=\"hljs-meta\">@AllArgsConstructor</span>\n<span class=\"hljs-meta\">@NoArgsConstructor</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SubAccount</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractSimpleDomainObject</span>&lt;<span class=\"hljs-title\">Long</span>&gt; </span>{\n\n    <span class=\"hljs-keyword\">private</span> Long id;\n\n    <span class=\"hljs-keyword\">private</span> String accountId;\n\n    <span class=\"hljs-keyword\">private</span> Account account;\n\n    <span class=\"hljs-keyword\">private</span> Integer eventStatus;\n}\n\n<span class=\"hljs-comment\">//AccountDao.class</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">AccountDao</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AggregateRootDao</span>&lt;<span class=\"hljs-title\">Account</span>,<span class=\"hljs-title\">Long</span>&gt; </span>{\n\n    <span class=\"hljs-function\">Account <span class=\"hljs-title\">findByAccountId</span><span class=\"hljs-params\">(@Param(<span class=\"hljs-string\">\"accountId\"</span>)</span>String accountId)</span>;\n\n    <span class=\"hljs-function\">List&lt;Account&gt; <span class=\"hljs-title\">findByAccountIds</span><span class=\"hljs-params\">(List&lt;String&gt; accountIds)</span></span>;\n}\n\n<span class=\"hljs-comment\">//SubAccountDao.class</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">SubAccountDao</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">DomainObjectDao</span>&lt;<span class=\"hljs-title\">SubAccount</span>,<span class=\"hljs-title\">Long</span>&gt; </span>{\n\n    <span class=\"hljs-function\">List&lt;SubAccount&gt; <span class=\"hljs-title\">findByParentId</span><span class=\"hljs-params\">(@Param(<span class=\"hljs-string\">\"parentId\"</span>)</span> Long parentId)</span>;\n}\n\n<span class=\"hljs-comment\">//AccountRepository.class</span>\n<span class=\"hljs-meta\">@Repository</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">AccountRepository</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">DaoAwareAggregateRepository</span>&lt;<span class=\"hljs-title\">Account</span>,<span class=\"hljs-title\">Long</span>&gt; </span>{\n\n    <span class=\"hljs-meta\">@Autowired</span>\n    <span class=\"hljs-keyword\">private</span> AccountDao accountDao;\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">AccountRepository</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">super</span>(Account<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Account <span class=\"hljs-title\">findByAccountId</span><span class=\"hljs-params\">(String accountId)</span> </span>{\n        <span class=\"hljs-keyword\">return</span> fetchAllComponents(accountDao.findByAccountId(accountId));\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;Account&gt; <span class=\"hljs-title\">findByAccountIds</span><span class=\"hljs-params\">(List&lt;String&gt; accountIds)</span> </span>{\n        <span class=\"hljs-keyword\">return</span> fetchAllComponents(accountDao.findByAccountIds(accountIds));\n    }\n}\n</code></pre>\n<p>AccountMapper.xml</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span>\n<span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-meta-keyword\">mapper</span> <span class=\"hljs-meta-keyword\">PUBLIC</span> <span class=\"hljs-meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"hljs-meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> &gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">\"AccountDao\"</span> &gt;</span>\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"baseResultMap\"</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"Account\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"id\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"ID\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"accountId\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"ACCOUNT_ID\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"eventStatus\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"EVENT_STATUS\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"createTime\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"CREATE_TIME\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"lastUpdateTime\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"LAST_UPDATE_TIME\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"version\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"VERSION\"</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"sql_select\"</span>&gt;</span>\n        SELECT ID,\n               ACCOUNT_ID,\n               EVENT_STATUS,\n               VERSION,\n               CREATE_TIME,\n               LAST_UPDATE_TIME\n        FROM ACCOUNT\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"findAll\"</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">\"baseResultMap\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"sql_select\"</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"findById\"</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">\"baseResultMap\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"sql_select\"</span>/&gt;</span>\n\t\tWHERE ID=#{id}\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"findByAccountId\"</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">\"baseResultMap\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"sql_select\"</span>/&gt;</span>\n        WHERE ACCOUNT_ID=#{accountId}\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"findByAccountIds\"</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">\"baseResultMap\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"sql_select\"</span>/&gt;</span>\n        WHERE ACCOUNT_ID in \n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">foreach</span> <span class=\"hljs-attr\">item</span>=<span class=\"hljs-string\">\"item\"</span> <span class=\"hljs-attr\">index</span>=<span class=\"hljs-string\">\"index\"</span> <span class=\"hljs-attr\">collection</span>=<span class=\"hljs-string\">\"list\"</span> <span class=\"hljs-attr\">separator</span>=<span class=\"hljs-string\">\",\"</span> <span class=\"hljs-attr\">open</span>=<span class=\"hljs-string\">\"(\"</span> <span class=\"hljs-attr\">close</span>=<span class=\"hljs-string\">\")\"</span>&gt;</span>\n            #{item}\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">foreach</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"insert\"</span> <span class=\"hljs-attr\">useGeneratedKeys</span>=<span class=\"hljs-string\">\"true\"</span> <span class=\"hljs-attr\">keyProperty</span>=<span class=\"hljs-string\">\"id\"</span> <span class=\"hljs-attr\">keyColumn</span>=<span class=\"hljs-string\">\"ID\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"Account\"</span>&gt;</span>\n        INSERT INTO ACCOUNT\n            (ACCOUNT_ID,EVENT_STATUS,VERSION,CREATE_TIME,LAST_UPDATE_TIME)\n        VALUES\n            (#{accountId},#{eventStatus},#{version},#{createTime},#{lastUpdateTime})\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">update</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"update\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"Account\"</span>&gt;</span>\n        UPDATE\n        `ACCOUNT`\n        SET\n        ACCOUNT_ID=#{accountId},\n        EVENT_STATUS=#{eventStatus},\n        VERSION=#{version},\n        LAST_UPDATE_TIME=#{lastUpdateTime}\n        WHERE ID=#{id}\n        AND VERSION=#{version}-1\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">update</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">delete</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"delete\"</span>&gt;</span>\n        DELETE FROM ACCOUNT WHERE ID=#{id}\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">delete</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span>\n</code></pre>\n<p>SubAccountMapper.xml</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span>\n<span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-meta-keyword\">mapper</span> <span class=\"hljs-meta-keyword\">PUBLIC</span> <span class=\"hljs-meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"hljs-meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> &gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">\"SubAccountDao\"</span> &gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"baseResultMap\"</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"SubAccount\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"id\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"ID\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"accountId\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"ACCOUNT_ID\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"account.id\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"PARENT_ID\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"eventStatus\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"EVENT_STATUS\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"createTime\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"CREATE_TIME\"</span>/&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">\"lastUpdateTime\"</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">\"LAST_UPDATE_TIME\"</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"sql_select\"</span>&gt;</span>\n        SELECT ID,\n               ACCOUNT_ID,\n               PARENT_ID,\n               EVENT_STATUS,\n               CREATE_TIME,\n               LAST_UPDATE_TIME\n        FROM SUB_ACCOUNT\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"findById\"</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">\"baseResultMap\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"sql_select\"</span>/&gt;</span>\n        WHERE ID=#{id}\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"findByParentId\"</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">\"baseResultMap\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"sql_select\"</span>/&gt;</span>\n        WHERE PARENT_ID = #{parentId}\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"insert\"</span> <span class=\"hljs-attr\">useGeneratedKeys</span>=<span class=\"hljs-string\">\"true\"</span> <span class=\"hljs-attr\">keyProperty</span>=<span class=\"hljs-string\">\"id\"</span> <span class=\"hljs-attr\">keyColumn</span>=<span class=\"hljs-string\">\"ID\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"SubAccount\"</span>&gt;</span>\n        INSERT INTO SUB_ACCOUNT\n            (ACCOUNT_ID,PARENT_ID,EVENT_STATUS,CREATE_TIME,LAST_UPDATE_TIME)\n        VALUES\n        (#{accountId},#{account.id},#{eventStatus},#{createTime},#{lastUpdateTime})\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">update</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"update\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"SubAccount\"</span>&gt;</span>\n        UPDATE\n            `SUB_ACCOUNT`\n        SET\n            ACCOUNT_ID=#{accountId},\n            PARENT_ID=#{account.id},\n            EVENT_STATUS=#{eventStatus},\n            LAST_UPDATE_TIME=#{lastUpdateTime}\n        WHERE ID=#{id}\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">update</span>&gt;</span>\n\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">delete</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"delete\"</span>&gt;</span>\n        DELETE FROM\n            SUB_ACCOUNT WHERE ID=#{id}\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">delete</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span>\n</code></pre>\n<h2 id=\"%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3\">核心注解 <a class=\"header-anchor\" href=\"#%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3\">#</a></h2>\n<h3 id=\"%40eventhandler\">@EventHandler <a class=\"header-anchor\" href=\"#%40eventhandler\">#</a></h3>\n<p>此注解作用于方法上，表明使用该方法作为事件处理器，<a href=\"/zh-cn/aggdocs/tutorial/eventhandler.html\">详见</a>。方法的入参有且仅有一个，是所需处理的事件类型（也可以是集合）。<strong>特别注意</strong>：1.可以为一个事件绑定多个事件处理器，彼此相互独立。2.事件处理器所在的类需要被注册到spring容器中。<br>\n<strong>属性说明</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"><div style=\"width:50px\">参数名</div></th>\n<th style=\"text-align:left\"><div style=\"width:200px\">含义</div></th>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">asynchronous</td>\n<td style=\"text-align:left\">是否异步执行</td>\n<td style=\"text-align:left\">boolean</td>\n<td style=\"text-align:left\">false</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">asyncConfig</td>\n<td style=\"text-align:left\">异步执行时的配置</td>\n<td style=\"text-align:left\"><a href=\"#%40asyncconfig\">AsyncConfig</a></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">postAfterTransaction</td>\n<td style=\"text-align:left\">是否在事务提交后执行</td>\n<td style=\"text-align:left\">boolean</td>\n<td style=\"text-align:left\">false</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">isTransactionMessage</td>\n<td style=\"text-align:left\">是否保证事务性(最终一致)</td>\n<td style=\"text-align:left\">boolean</td>\n<td style=\"text-align:left\">false</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">transactionCheck</td>\n<td style=\"text-align:left\">需要保证事务的情况下，校验该处理器是否需要执行的方法名，入参为事件类型，返回boolean值</td>\n<td style=\"text-align:left\">TransactionCheck</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">order</td>\n<td style=\"text-align:left\">异步confirm</td>\n<td style=\"text-align:left\">boolean</td>\n<td style=\"text-align:left\">Integer.MIN_VALUE(最先执行)</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"%40asyncconfig\">@AsyncConfig <a class=\"header-anchor\" href=\"#%40asyncconfig\">#</a></h3>\n<p>AGG内部集成了<a href=\"https://lmax-exchange.github.io/disruptor/\">Disruptor</a>框架，用于提升异步事件的处理性能，此注解用于设置其相关配置<br>\n<strong>属性说明</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"><div style=\"width:50px\">参数名</div></th>\n<th style=\"text-align:left\"><div style=\"width:200px\">含义</div></th>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">queueFullPolicy</td>\n<td style=\"text-align:left\">环形队列打满时的处理策略</td>\n<td style=\"text-align:left\">枚举，可取值：DISCARD直接丢弃、ENQUEUE等待入队、SYNCHRONOUS使用当前线程执行</td>\n<td style=\"text-align:left\">SYNCHRONOUS</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ringBufferSize</td>\n<td style=\"text-align:left\">环形缓冲队列大小</td>\n<td style=\"text-align:left\">int</td>\n<td style=\"text-align:left\">4096</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">workPoolSize</td>\n<td style=\"text-align:left\">工作线程数(事件处理器入参为非集合时使用)</td>\n<td style=\"text-align:left\">int</td>\n<td style=\"text-align:left\">24</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">maxBatchSize</td>\n<td style=\"text-align:left\">批处理大小上限(事件处理器入参为集合时使用)</td>\n<td style=\"text-align:left\">int</td>\n<td style=\"text-align:left\">1024</td>\n</tr>\n</tbody>\n</table>\n",
  "link": "/zh-cn/aggdocs/tutorial/api.html",
  "meta": {}
}